{"version":3,"sources":["src/Game/GameWindow.js"],"names":[],"mappings":"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","file":"src/Game/GameWindow.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n  let internal = Sprite.Namespace();\n  /** 全部窗口 */\n  let windows = new Set();\n  /**窗口z-index，不断递增 */\n  let zIndex = 227;\n\n  Game.assign(\"Window\", class GameWindow extends Sprite.Event {\n    static create (id) {\n      let win = new Game.Window(id)\n      return win;\n    }\n\n    /**\n     * @constructor\n     */\n    constructor (id) {\n      super();\n\n      let privates = internal(this);\n      privates.id = id;\n      privates.css = document.createElement(\"style\");\n      privates.html = document.createElement(\"div\");\n      privates.index = -1;\n\n      // 随机一个字符串作为dom的id\n      privates.html.id = \"GW\" + Math.random().toString(16).substr(2);\n      privates.html.classList.add(id);\n      privates.html.classList.add(\"game-window\");\n      privates.html.style.display = \"none\";\n      document.body.appendChild(privates.html);\n      document.head.appendChild(privates.css)\n\n      privates.html.addEventListener(\"mousedown\", (event) => {\n        let x = event.clientX;\n        let y = event.clientY;\n\n        let left = null;\n        let top = null;\n        let scale = null;\n\n        if (privates.html.style.left) {\n          let t = privates.html.style.left.match(/(\\d+)px/);\n          if (t) {\n            left = parseInt(t[1]);\n          }\n        }\n\n        if (privates.html.style.top) {\n          let t = privates.html.style.top.match(/(\\d+)px/);\n          if (t) {\n            top = parseInt(t[1]);\n          }\n        }\n\n        if (privates.html.style.transform) {\n          let t = privates.html.style.transform.match(/scale\\(([\\d\\.]+), ([\\d\\.]+)\\)/);\n          if (t) {\n            scale = parseFloat(t[1]);\n          }\n        }\n\n        if (typeof left == \"number\" && typeof top == \"number\" && typeof scale == \"number\") {\n          x -= left;\n          y -= top;\n          x /= scale;\n          y /= scale;\n          this.emit(\"mousedown\", false, {\n            x: x,\n            y: y\n          });\n        }\n      });\n\n      windows.add(this);\n    }\n\n    destroy () {\n      let privates = internal(this);\n      if (this.showing) {\n        this.hide();\n      }\n      if (privates.html) {\n        document.body.removeChild(privates.html);\n        privates.html = null;\n      }\n      if (privates.css) {\n        document.head.removeChild(privates.css);\n        privates.css = null;\n      }\n      if (windows.has(this)) {\n        windows.delete(this);\n      }\n    }\n\n    whenPress (keys, callback) {\n      Sprite.Input.whenPress(keys, (key) => {\n        if (this.atop) {\n          callback(key);\n        }\n      });\n      return this;\n    }\n\n    whenUp (keys, callback) {\n      Sprite.Input.whenUp(keys, (key) => {\n        if (this.atop) {\n          callback(key);\n        }\n      });\n      return this;\n    }\n\n    whenDown (keys, callback) {\n      Sprite.Input.whenDown(keys, (key) => {\n        if (this.atop) {\n          callback(key);\n        }\n      });\n      return this;\n    }\n\n    assign (name, object) {\n      Object.defineProperty(this, name, {\n        enumerable: false,\n        configurable: false,\n        writable: false,\n        value: object\n      });\n\n      return this;\n    }\n\n    show () {\n      let privates = internal(this);\n      GameWindowResize();\n      if (this.showing == false && privates.html) {\n        this.emit(\"beforeShow\");\n\n        for (let win of windows) {\n          if (win.atop) {\n            win.emit(\"deactive\");\n          }\n        }\n\n        privates.index = zIndex;\n        privates.html.style.zIndex = privates.index;\n        privates.html.style.display = \"block\";\n        zIndex++;\n        this.emit(\"afterShow\");\n        this.emit(\"active\");\n      }\n      return this;\n    }\n\n    hide () {\n      let privates = internal(this);\n      if (privates.html) {\n        this.emit(\"beforeHide\");\n        privates.index = -1;\n        privates.html.style.zIndex = privates.index;\n        privates.html.style.display = \"none\";\n        this.emit(\"afterHide\");\n        this.emit(\"deactive\");\n\n        for (let win of windows) {\n          if (win.atop) {\n            win.emit(\"active\");\n          }\n        }\n      }\n      return this;\n    }\n\n    querySelector (selector) {\n      let privates = internal(this);\n      return document.querySelector(`#${privates.html.id} ${selector}`);\n    }\n\n    querySelectorAll (selector) {\n      let privates = internal(this);\n      return document.querySelectorAll(`#${privates.html.id} ${selector}`);\n    }\n\n    get index () {\n      let privates = internal(this);\n      return privates.index;\n    }\n\n    set index (value) {\n      console.error(this);\n      throw new Error(\"Game.Window.index readonly\");\n    }\n\n    get showing () {\n      let privates = internal(this);\n      if (privates.html && privates.html.style.display != \"none\") {\n        return true;\n      }\n      return false;\n    }\n\n    set showing (value) {\n      throw new Error(\"Game.Window.showing readonly\");\n    }\n\n    get atop () {\n      for (let win of windows) {\n        if (win.showing && win.index > this.index) {\n          return false;\n        }\n      }\n      return true;\n    }\n\n    set atop (value) {\n      throw new Error(\"Game.Window.atop readonly\");\n    }\n\n    get html () {\n      return internal(this).html.innerHTML;\n    }\n\n    set html (value) {\n      internal(this).html.innerHTML = value;\n    }\n\n    get css () {\n      return internal(this).css.innerHTML;\n    }\n\n    set css (value) {\n      internal(this).css.innerHTML = value;\n    }\n\n    appendChild (domElement) {\n      internal(this).html.appendChild(domElement);\n      return this;\n    }\n\n    removeChild (domElement) {\n      internal(this).html.removeChild(domElement);\n      return this;\n    }\n  });\n\n  // 当窗口大小改变时改变游戏窗口大小\n  function GameWindowResize () {\n    let width = window.innerWidth;\n    let height = window.innerHeight;\n    let scale = 1;\n    let leftMargin = 0;\n    let topMargin = 0;\n\n    if (Game.config.scale == false) {\n      // 不拉伸游戏窗口，按原始大小计算窗口居中\n      leftMargin = Math.floor((width - Game.config.width) / 2);\n      topMargin = Math.floor((height - Game.config.height) / 2);\n    } else {\n      // 拉伸游戏窗口，首先计算游戏原始大小比例\n      let ratio = Game.config.width / Game.config.height;\n      // width first\n      let w = width;\n      let h = w / ratio;\n      // then height\n      if (h > height) {\n        h = height;\n        w = h * ratio;\n      }\n\n      w = Math.floor(w);\n      h = Math.floor(h);\n      leftMargin = Math.floor((width - w) / 2);\n      topMargin = Math.floor((height - h) / 2);\n\n      scale = Math.min(\n        w / Game.config.width,\n        h / Game.config.height\n      );\n\n      scale = scale.toFixed(3);\n    }\n\n    // html窗口拉伸（css中控制了原始大小）\n    for (let win of windows) {\n      internal(win).html.style.transformOrigin = \"0 0 0\";\n      internal(win).html.style.transform = `scale(${scale}, ${scale})`;\n      internal(win).html.style.left = `${leftMargin}px`;\n      internal(win).html.style.top = `${topMargin}px`;\n    }\n\n    if (Game.hero) {\n      Game.hero.focus();\n    }\n\n  }\n\n  GameWindowResize();\n  window.addEventListener(\"resize\", function () {\n    GameWindowResize();\n  });\n\n})();\n"]}