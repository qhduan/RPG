{"version":3,"sources":["src/Game/GameWindowPickup.js"],"names":[],"mappings":"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","file":"src/Game/GameWindowPickup.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n  let win = Game.windows.pickup = Game.Window.create(\"pickupWindow\");\n\n  win.html = `\n    <div class=\"window-box\">\n      <button id=\"pickupWindowClose\" class=\"brownButton\">关闭</button>\n      <button id=\"pickupWindowAll\" class=\"brownButton\">A 全部</button>\n      <table border=\"1\" cellspacing=\"0\" cellpadding=\"0\">\n        <thead>\n          <tr>\n            <td style=\"width: 40px;\"></td>\n            <td style=\"width: 120px;\"></td>\n            <td style=\"width: 30px;\"></td>\n            <td style=\"width: 30px;\"></td>\n            <td></td>\n            <td style=\"width: 60px;\"></td>\n          </tr>\n        </thead>\n        <tbody id=\"pickupWindowTable\"></tbody>\n      </table>\n    </div>\n  `;\n\n  win.css = `\n    .pickupWindow table {\n      width: 100%;\n    }\n\n    .pickupWindow table img {\n      width: 100%;\n      height: 100%;\n    }\n\n    .pickupWindow button {\n      width: 60px;\n      height: 40px;\n      font-size: 16;\n    }\n\n    #pickupWindowClose {\n\n    }\n\n    #pickupWindowAll {\n\n    }\n  `;\n\n  let pickupWindowClose = win.querySelector(\"button#pickupWindowClose\");\n  let pickupWindowAll = win.querySelector(\"button#pickupWindowAll\");\n  let pickupWindowTable = win.querySelector(\"#pickupWindowTable\");\n\n  let currentItemObj = null;\n  let lastSelect = -1;\n\n  pickupWindowClose.addEventListener(\"click\", function (event) {\n    Game.windows.pickup.hide();\n  });\n\n  pickupWindowAll.addEventListener(\"click\", function (event) {\n    let itemObj = currentItemObj;\n    if (itemObj && itemObj.inner && Object.keys(itemObj.inner).length > 0) {\n      Sprite.each(itemObj.inner, function (itemCount, itemId, inner) {\n        if (itemId == \"gold\") {\n          Game.hero.data.gold += itemCount;\n        } else {\n          if (Game.hero.data.items[itemId]) {\n            Game.hero.data.items[itemId] += itemCount;\n          } else {\n            Game.hero.data.items[itemId] = itemCount;\n          }\n        }\n        delete inner[itemId];\n      });\n      Game.windows.pickup.open(itemObj);\n    }\n  });\n\n  win.whenUp([\"a\", \"A\"], function (key) {\n    pickupWindowAll.click();\n  });\n\n  win.whenUp([\"esc\"], function (key) {\n    setTimeout(function () {\n      win.hide();\n    }, 20);\n  });\n\n  win.whenUp([\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\"], function (key) {\n    let buttons = pickupWindowTable.querySelectorAll(\"button\");\n    for (let i = 0, len = buttons.length; i < len; i++) {\n      let buttonIndex = buttons[i].getAttribute(\"data-index\");\n      if (buttonIndex) {\n        if (buttonIndex == key) {\n          buttons[i].click();\n        }\n      }\n    }\n  });\n\n  win.assign(\"open\", function (itemObj, select) {\n    if (typeof select == \"undefined\") {\n      select = -1;\n    }\n\n    lastSelect = select;\n\n    if (!itemObj.inner || Object.keys(itemObj.inner).length <= 0) {\n      for (let bag of Game.area.bags) {\n        if (bag == itemObj) {\n          Game.area.bags.delete(bag);\n          itemObj.erase();\n        }\n      }\n      Game.windows.pickup.hide();\n      return;\n    }\n\n    currentItemObj = itemObj;\n\n    let index = 1;\n    let table = \"\";\n    Sprite.each(itemObj.inner, function (itemCount, itemId, inner) {\n      let item = Game.items[itemId];\n\n      let line = \"\";\n\n      if (select == (index - 1)) {\n        line += `<tr style=\"background-color: green;\">\\n`;\n      } else {\n        line += `<tr>\\n`;\n      }\n\n\n      if (item.icon) {\n        line += `  <td><img alt=\"\" src=\"${item.icon.src}\"></td>\\n`;\n      } else {\n        line += `  <td> </td>\\n`;\n      }\n      line += `  <td>${item.data.name}</td>\\n`;\n      line += `  <td style=\"text-align: center;\">${item.data.value}G</td>\\n`;\n      line += `  <td style=\"text-align: center;\">${itemCount}</td>\\n`;\n      line += `  <td>${item.data.description}</td>\\n`;\n      line += `  <td><button data-id=\"${itemId}\" data-index=\"${index}\" class=\"brownButton\">${index<=9?(index):\"\"} 拿取</button></td>\\n`;\n\n      line += \"</tr>\\n\";\n      table += line;\n      index++;\n    });\n\n    pickupWindowTable.innerHTML = table;\n    Game.windows.pickup.show();\n  });\n\n  win.whenUp([\"enter\"], function () {\n    let buttons = pickupWindowTable.querySelectorAll(\"button\");\n    if (lastSelect >= 0 && lastSelect < buttons.length) {\n      buttons[lastSelect].click();\n    }\n  });\n\n  win.whenUp([\"up\", \"down\"], function (key) {\n    let count = pickupWindowTable.querySelectorAll(\"button\").length;\n\n    if (lastSelect == -1) {\n      if (key == \"down\") {\n        win.open(currentItemObj, 0);\n      } else if (key == \"up\") {\n        win.open(currentItemObj, count - 1);\n      }\n    } else {\n      if (key == \"down\") {\n        let select = lastSelect + 1;\n        if (select >= count) {\n          select = 0;\n        }\n        win.open(currentItemObj, select);\n      } else if (key == \"up\") {\n        let select = lastSelect - 1;\n        if (select < 0) {\n          select = count - 1;\n        }\n        win.open(currentItemObj, select);\n      }\n    }\n  });\n\n  pickupWindowTable.addEventListener(\"click\", function (event) {\n    let itemId = event.target.getAttribute(\"data-id\");\n    if (itemId && currentItemObj.inner && currentItemObj.inner.hasOwnProperty(itemId)) {\n      let itemCount = currentItemObj.inner[itemId];\n      if(itemId == \"gold\") {\n        Game.hero.data.gold += itemCount;\n      } else {\n        if (Game.hero.data.items.hasOwnProperty(itemId)) {\n          Game.hero.data.items[itemId] += itemCount;\n        } else {\n          Game.hero.data.items[itemId] = itemCount;\n        }\n      }\n      delete currentItemObj.inner[itemId];\n      win.open(currentItemObj);\n    }\n  });\n\n})();\n"]}