{"version":3,"sources":["src/GameCore.js"],"names":[],"mappings":"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","file":"src/GameCore.js","sourcesContent":["/*\n\nA-RPG Game, Built using Node.js + JavaScript + ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n(function () {\n  \"use strict\";\n\n  // root级别api入口\n  var Game = window.Game = {\n    items: {\n      // 保存items的Game.ItemClass对象缓存\n    },\n    skills: {\n      // 保存skills的Game.SkillClass对象缓存\n    },\n    config: { // 保存所有设置（默认设置）\n      walk: 4, // 角色行走速度\n      run: 8, // 角色跑动速度\n      width: 800, // 渲染窗口的原始大小\n      height: 450,\n      scale: false, // 如果不拉伸，那么无论浏览器窗口多大，都是原始大小；拉伸则按比例填满窗口\n      fps: 35, // 锁定fps到指定数值，如果设置为<=0，则不限制\n    }\n  };\n\n  Game.ShowWindow = function (id) {\n    var elements = document.getElementsByClassName(\"game-window\");\n    for (let i = 0; i < elements.length; i++) {\n      elements[i].style.display = \"none\";\n    }\n    if (id && document.getElementById(id)) {\n      document.getElementById(id).style.display = \"block\";\n    }\n  }\n\n\n  // 当窗口大小改变时改变游戏窗口大小\n  Game.ResizeWindow = function () {\n    var width = window.innerWidth;\n    var height = window.innerHeight;\n    var scale = 1;\n    var leftMargin = 0;\n    var topMargin = 0;\n\n    if (Game.config.scale == false) {\n      // 不拉伸游戏窗口，按原始大小计算窗口居中\n      leftMargin = Math.floor((width - Game.config.width) / 2);\n      topMargin = Math.floor((height - Game.config.height) / 2);\n    } else {\n      // 拉伸游戏窗口，首先计算游戏原始大小比例\n      var ratio = Game.config.width / Game.config.height;\n      // width first\n      var w = width;\n      var h = w / ratio;\n      // then height\n      if (h > height) {\n        h = height;\n        w = h * ratio;\n      }\n\n      w = Math.floor(w);\n      h = Math.floor(h);\n      leftMargin = Math.floor((width - w) / 2);\n      topMargin = Math.floor((height - h) / 2);\n\n      scale = Math.min(\n        w / Game.config.width,\n        h / Game.config.height\n      );\n    }\n\n    // html窗口拉伸（css中控制了原始大小）\n    var elements = document.getElementsByClassName(\"game-window\");\n    for (let i = 0; i < elements.length; i++) {\n      elements[i].style.transformOrigin = \"0 0 0\";\n      // elements[i].style.transform = `scale(${scale}, ${scale})`;\n      elements[i].style.transform = `scale3d(${scale}, ${scale}, 1.0)`;\n      elements[i].style.left = `${leftMargin}px`;\n      elements[i].style.top = `${topMargin}px`;\n    }\n    // 游戏画布拉伸\n    if (Game.stage && Game.stage.canvas) {\n      Game.stage.canvas.style.transformOrigin = \"0 0 0\";\n      // Game.stage.canvas.style.transform = `scale(${scale}, ${scale})`;\n      Game.stage.canvas.style.transform = `scale3d(${scale}, ${scale}, 1.0)`;\n      Game.stage.canvas.style.left = `${leftMargin}px`;\n      Game.stage.canvas.style.top = `${topMargin}px`;\n    }\n\n    if (Game.hero) {\n      Game.hero.focus();\n    }\n\n  };\n\n  Game.ResizeWindow();\n  window.addEventListener(\"resize\", function () {\n    Game.ResizeWindow();\n  });\n\n  Game.clearStage = function () {\n    for (var i = 0; i < Game.stage.children.length; i++) {\n      Game.stage.children[i].clear();\n    }\n  };\n\n  Game.init = function () {\n\n    Game.stage = new Sprite.Stage(Game.config.width, Game.config.height);\n    document.body.appendChild(Game.stage.canvas);\n    Game.stage.canvas.style.position = \"fixed\";\n\n    Game.mapLayer = new Sprite.Container();\n    Game.mapLayer.name = \"mapLayer\";\n\n    Game.actorLayer = new Sprite.Container();\n    Game.actorLayer.name = \"actorLayer\";\n\n    Game.itemLayer = new Sprite.Container();\n    Game.itemLayer.name = \"itemLayer\";\n\n    Game.heroLayer = new Sprite.Container();\n    Game.heroLayer.name = \"heroLayer\";\n\n    Game.skillLayer = new Sprite.Container();\n    Game.skillLayer.name = \"skillLayer\";\n\n    Game.dialogueLayer = new Sprite.Container();\n    Game.dialogueLayer.name = \"dialogueLayer\";\n\n    Game.stage.appendChild(\n      Game.mapLayer,\n      Game.actorLayer,\n      Game.itemLayer,\n      Game.heroLayer,\n      Game.skillLayer,\n      Game.dialogueLayer\n    );\n\n    Sprite.Ticker.on(\"tick\", function () {\n      Game.stage.update();\n    });\n\n    var fps = 0;\n    var start = new Date().getTime();\n    Game.stage.on(\"drawEnd\", function () {\n      fps++;\n    });\n    setInterval(function () {\n      var now = new Date().getTime();\n      var f = fps / ((now - start)/1000);\n      fps = 0;\n      start = now;\n      document.getElementById(\"fps\").innerHTML = f.toFixed(2);\n    }, 1000);\n\n\n    Game.ResizeWindow();\n\n    console.log(\"RPG Game Flying!\");\n  };\n\n\n\n})();\n"]}