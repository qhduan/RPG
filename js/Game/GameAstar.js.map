{"version":3,"sources":["src/Game/GameAstar.js"],"names":[],"mappings":"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","file":"src/Game/GameAstar.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n  /**\n   * 自动寻路算法\n   */\n  Game.assign(\"Astar\", class GameAstar {\n    /**\n     * @param {function} collisionFunction 测试是否阻挡\n     * @param {number} width 地图宽度\n     * @param {number} height 地图高度\n     * @param {Object} start 起始位置 eg. {x: 0, y: 0}\n     * @param {Object} end\n     */\n    static path (collisionFunction, width, height, start, end) {\n      // 用一个点结构的x和y值返回一个字符串的key\n      // 例如{x: 9, y: 8}返回\"9-8\"\n      let tag = function (point) {\n        return point.x.toString() + \"-\" + point.y.toString();\n      };\n      // 计算点结构a和b之间的曼哈顿距离，即不带斜走的直线距离\n      let manhattan = function (a, b) {\n        return Math.abs(a.x - b.x) + Math.abs(a.y - b.y);\n      };\n      // 粗略验证一个点是否可用，是否超出边界，地图上是否是墙\n      let valid = function (x, y) {\n        if (collisionFunction(x, y))\n          return false;\n        return true;\n      };\n      // 通过坐标x，y，当前最好的节点best和一个附加值（直线10，斜线14），返回一个新节点\n      let make = function (x, y, best, addition, direction) {\n        let t = {\n          x: x,\n          y: y,\n          g: best.g + addition\n        };\n        t.key = tag(t);\n        t.h = manhattan(t, end);\n        t.f = t.g + t.h;\n        t.front = best.front.slice();\n        t.front.push(best.key);\n        return t;\n      };\n\n      // 开启列表和关闭列表\n      let open = {};\n      let close = {};\n\n      //构建起始节点\n      open[tag(start)] = {\n        x: start.x,\n        y: start.y,\n        key: tag(start),\n        f: 0,\n        g: 0,\n        h: manhattan(start, end),\n        front: []\n      };\n\n      while (Object.keys(open).length) {\n        // 找到F值最小的节点\n        let best = null;\n        for (let key in open) {\n          if (best == null || open[key].f < best.f) {\n            best = open[key];\n          }\n        }\n        // 从开启列表中删除，加入关闭列表\n        delete open[best.key];\n        close[best.key] = best;\n\n        // 如果这个最好的节点就是结尾节点，则返回\n        if (best.x == end.x && best.y == end.y) {\n          best.front.push(tag(end));\n          let result = [];\n          for (let i = 0, len = best.front.length; i < len; i++) {\n            let m = best.front[i].match(/(\\d+)-(\\d+)/);\n            if (m) {\n              result.push({\n                x: parseInt(m[1]),\n                y: parseInt(m[2])\n              });\n            }\n          }\n          return result;\n        }\n\n        // 记录上下左右，和四个斜方向的可能值\n        let possible = [];\n\n        if (valid(best.x, best.y - 1)) { // 验证up\n          possible.push(make(best.x, best.y - 1, best, 10));\n        }\n        if (valid(best.x, best.y + 1)) { // 验证down\n          possible.push(make(best.x, best.y + 1, best, 10));\n        }\n        if (valid(best.x - 1, best.y)) { // 验证left\n          possible.push(make(best.x - 1, best.y, best, 10));\n        }\n        if (valid(best.x + 1, best.y)) { // 验证right\n          possible.push(make(best.x + 1, best.y, best, 10));\n        }\n\n        // 去除已经在开启列表和关闭列表中的\n        possible.forEach(function (element) {\n          let t = tag(element);\n          if (open[t]) return;\n          if (close[t]) return;\n          open[t] = element;\n        });\n\n      } // while\n\n      return null;\n    }\n  });\n\n\n\n})();\n"]}