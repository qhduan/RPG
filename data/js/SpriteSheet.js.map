{"version":3,"sources":["src/SpriteSheet.js"],"names":[],"mappings":"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","file":"src/SpriteSheet.js","sourcesContent":["/*\n\n2D Game Sprite Library, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n/// @file SpriteSheet.js\n/// @namespace Sprite\n/// class Sprite.Sheet\n\n(function () {\n  \"use strict\";\n\n  Sprite.Sheet = class Sheet extends Sprite.Display {\n    constructor (config) {\n      super();\n\n      if (!config.images || !config.width || !config.height) {\n        console.log(config)\n        throw new TypeError(\"Sprite.Sheet.constructor get invalid arguments\");\n      }\n\n      this._images = config.images;\n      this._tilewidth = config.width;\n      this._tileheight = config.height;\n      this._animations = config.animations || {};\n      this._currentAnimation = null;\n      this._currentFrame = 0;\n      this._animationTimer = null;\n\n    }\n\n    clone () {\n      var sheet = new Sheet({\n        images: this._images,\n        width: this._tilewidth,\n        height: this._tileheight,\n        animations: this._animations\n      });\n      sheet.x = this.x;\n      sheet.y = this.y;\n      sheet.center.x = this.center.x;\n      sheet.center.y = this.center.y;\n      sheet.scale.x = this.scale.x;\n      sheet.scale.y = this.scale.y;\n      sheet._currentFrame = this._currentFrame;\n      return sheet;\n    }\n\n    get paused () {\n      if (this._animationTimer)\n        return false;\n      return true;\n    }\n\n    set paused (value) {\n      throw new Error(\"Sprite.Sheet 'paused' readonly\");\n    }\n\n    get currentFrame () {\n      return this._currentFrame;\n    }\n\n    set currentFrame (value) {\n      throw new Error(\"Sprite.Sheet.currentFrame readonly\");\n    }\n\n    get currentAnimation () {\n      return this._currentAnimation;\n    }\n\n    set currentAnimation (value) {\n      throw new Error(\"Sprite.Sheet.currentAnimation readonly\");\n    }\n\n    play (choice) {\n      if (this._animationTimer) {\n        clearInterval(this._animationTimer);\n        this._animationTimer = null;\n      }\n\n      if (typeof choice == \"number\") {\n        this._currentFrame = choice;\n        this.emit(\"change\");\n      } else if (typeof choice == \"string\") {\n\n        var animation = this._animations[choice];\n\n        if (!animation) {\n          throw new Error(\"Sprite.Sheet.play invalid animation\");\n        }\n\n        // if animation is single frame number\n        if (typeof animation == \"number\") {\n          this._currentAnimation = choice;\n          this.play(animation);\n          return;\n        }\n\n        var begin;\n        var end;\n        var next;\n        var time;\n\n        if (animation instanceof Array) {\n          begin = animation[0];\n          end = animation[1];\n          next = animation[2];\n          time = animation[3];\n        } else if (animation.frames instanceof Array) {\n          begin = animation.frames[0];\n          end = animation.frames[animation.frames.length - 1];\n          next = animation.next;\n          time = animation.speed;\n        }\n\n        if (typeof begin != \"number\" || typeof end != \"number\" || typeof time != \"number\") {\n          console.error(begin, end, time);\n          throw new Error(\"Sprite.Sheet.play Invalid Sheet Data\");\n        }\n\n        this._currentAnimation = choice;\n        this._currentFrame = begin;\n        this.emit(\"change\");\n\n        this._animationTimer = setInterval(() => {\n          this._currentFrame++;\n          if (this._currentFrame > end) {\n            clearInterval(this._animationTimer);\n            this._animationTimer = null;\n            if (next && next.length && this._animations[next]) {\n              this.play(next);\n            } else {\n              this._currentFrame--;\n            }\n            this.emit(\"animationend\");\n          }\n          this.emit(\"change\");\n        }, time);\n      } else {\n        throw new Error(\"Sprite.Sheet.play has an invalid argument\");\n      }\n    }\n\n    getFrame (frame) {\n      for (let i = 0; i < this._images.length; i++) {\n        var image = this._images[i];\n        var col = Math.floor(image.width / this._tilewidth);\n        var row = Math.floor(image.height / this._tileheight);\n        if (frame < row * col) {\n          return {\n            image: image,\n            x: Math.floor(frame % col) * this._tilewidth,\n            y: Math.floor(frame / col) * this._tileheight,\n            width: this._tilewidth,\n            height: this._tileheight,\n            center: this.center,\n          };\n        } else {\n          frame -= row * col;\n        }\n      }\n    }\n\n    draw (context) {\n      var frame = this.getFrame(this._currentFrame);\n      if (!frame || !frame.image) {\n        console.error(frame, this._currentFrame, this);\n        throw new Error(\"Sprite.Sheet.draw invalid frame\");\n      }\n      this.drawImage(context, frame.image, frame.x, frame.y, frame.width, frame.height);\n    }\n\n  };\n\n})();\n"]}