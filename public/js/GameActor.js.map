{"version":3,"sources":["public/src/GameActor.js"],"names":[],"mappings":"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","file":"public/src/GameActor.js","sourcesContent":["/*\n\nA-RPG Game, Built using Node.js + JavaScript + ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n(function () {\n  \"use strict\";\n\n  /*\n    角色类，包括涉及到hero和npc\n    属性：\n      this.sprite 精灵\n  */\n  Game.ActorClass = class ActorClass extends Sprite.Event {\n    constructor (actorData) {\n      super();\n\n      this.data = actorData;\n      this.id = this.data.id;\n\n      // 名字\n      var text = new Sprite.Text({\n        text: this.data.name,\n        maxWidth: 200,\n        color: \"white\",\n        fontSize: 12\n      });\n      text.center.y = Math.floor(text.height / 2);\n      text.center.x = Math.floor(text.width / 2);\n      text.x = 0;\n      text.y = 0;\n      this.text = text;\n\n      // 一个上面四个精神条、血条的聚合，统一管理放入这个Container\n      this.infoBox = new Sprite.Container();\n\n      if (this.data.type == \"npc\") {\n        this.text.y += 10;\n        this.infoBox.appendChild(this.text);\n      } else {\n        // 血条外面的黑框\n        this.hpbarBox = new Sprite.Shape();\n        this.hpbarBox.center.x = 15;\n        this.hpbarBox.center.y = 2;\n        this.hpbarBox.x = 0;\n        this.hpbarBox.y = 10;\n\n        // 魔法条外面的黑框\n        this.mpbarBox = new Sprite.Shape();\n        this.mpbarBox.center.x = 15;\n        this.mpbarBox.center.y = 2;\n        this.mpbarBox.x = 0;\n        this.mpbarBox.y = 12;\n\n        this.hpbarBox.rect({\n          x: 0,\n          y: 0,\n          width: 30,\n          height: 3,\n          \"fill-opacity\": 0\n        });\n\n        this.mpbarBox.rect({\n          x: 0,\n          y: 0,\n          width: 30,\n          height: 3,\n          \"fill-opacity\": 0\n        });\n\n        // 生命条\n        this.hpbar = new Sprite.Shape();\n        this.hpbar.center.x = 15;\n        this.hpbar.center.y = 2;\n        this.hpbar.x = 0;\n        this.hpbar.y = 10;\n\n        // 精力条\n        this.mpbar = new Sprite.Shape();\n        this.mpbar.center.x = 15;\n        this.mpbar.center.y = 2;\n        this.mpbar.x = 0;\n        this.mpbar.y = 12;\n\n        this.refreshBar();\n\n        this.infoBox.appendChild(this.text,\n          this.hpbarBox, this.mpbarBox, this.hpbar, this.mpbar);\n      }\n\n      var Init = (image) => {\n        var sprite = new Sprite.Sheet({\n          images: [image],\n          width: this.data.tilewidth,\n          height: this.data.tileheight,\n          animations: this.data.animations,\n        });\n\n        //.center.x.center.y把角色中间设定为图片中间\n        sprite.center.x = Math.floor(this.data.tilewidth / 2);\n        sprite.center.y = Math.floor(this.data.tileheight / 2);\n        sprite.play(\"facedown\");\n        sprite.x = 0;\n        sprite.y = 0;\n        this.sprite = sprite;\n\n        var completeCount = -1;\n        var Complete = () => {\n          completeCount++;\n          if (completeCount >= 0) {\n            this.emit(\"complete\", true);\n          }\n        };\n\n        if (this.data.skills) {\n          this.skills = {};\n          this.data.skills.forEach((element) => {\n            var skillLoader = new Sprite.Loader();\n            skillLoader.add(`/skill/${element}.json`);\n            skillLoader.start();\n            completeCount--;\n            skillLoader.on(\"complete\", (event) => {\n              var skillData = event.data[0];\n              var skillObj = new Game.SkillClass(skillData);\n              this.skills[element] = skillObj;\n              Complete();\n            });\n          });\n        }\n\n        var LoadItem = (element) => {\n          if (Game.items.hasOwnProperty(element) == false) {\n            Game.items[element] = true;\n            var itemLoader = new Sprite.Loader();\n            itemLoader.add(`/item/${element}.json`);\n            itemLoader.start();\n            completeCount--;\n            itemLoader.on(\"complete\", (event) => {\n              var itemData = event.data[0];\n              var itemObj = new Game.ItemClass(itemData);\n              Game.items[element] = itemObj;\n              Complete();\n            });\n          }\n        };\n\n        if (this.data.equipment) {\n          for (var key in this.data.equipment) {\n            var equipment = this.data.equipment[key];\n            if (equipment) {\n              LoadItem(equipment);\n            }\n          }\n        }\n\n        if (this.data.items) {\n          for (var itemId in this.data.items) {\n            LoadItem(itemId);\n          }\n        }\n\n        Complete();\n      }\n\n      if (this.data.image instanceof Image) {\n        Init(this.data.image);\n      } else if (typeof this.data.image == \"string\") {\n        var loader = new Sprite.Loader();\n        loader.add(\"/actor/\" + this.data.image);\n        loader.start();\n        loader.on(\"complete\", function (event) {\n          Init(event.data[0]);\n        });\n      } else {\n        console.error(this.id, this.data, this.data.image, this);\n        throw new Error(\"Invalid Actor Image\");\n      }\n\n      this.calculate();\n\n      this.on(\"move\", () => {\n        if (this.popupBox && Object.keys(this.popupBox).length) {\n          for (let key in this.popupBox) {\n            this.popupBox[key].x = this.x;\n            this.popupBox[key].y = this.y - this.sprite.center.y;\n          }\n        }\n      });\n    }\n\n    calculate () {\n      this.data.str = this.data.$str;\n      this.data.dex = this.data.$dex;\n      this.data.con = this.data.$con;\n      this.data.int = this.data.$int;\n      this.data.cha = this.data.$cha;\n      // 然后可以针对基本属性计算buff\n      this.data.$hp = this.data.con * 10;\n      this.data.$sp = this.data.int * 10;\n      this.data.$atk = this.data.str * 2;\n      this.data.$def = this.data.dex * 2;\n      this.data.$matk = this.data.int * 1.5;\n      this.data.$mdef = this.data.int * 0.5;\n      // 计算完了战斗相关数值\n      this.data.hp = this.data.$hp;\n      this.data.sp = this.data.$sp;\n      this.data.atk = this.data.$atk;\n      this.data.def = this.data.$def;\n      this.data.matk = this.data.$matk;\n      this.data.mdef = this.data.$mdef;\n      // 最后可以对战斗相关数值计算buff\n    }\n\n    get x () {\n      return this.sprite.x;\n    }\n\n    get y () {\n      return this.sprite.y;\n    }\n\n    set x (v) {\n      this.sprite.x = v;\n    }\n\n    set y (v) {\n      this.sprite.y = v;\n    }\n\n    clone  (callback) {\n      var actorObj = new ActorClass(this.data);\n      actorObj.oncomplete(callback);\n    }\n\n    refreshBar () {\n      var hpcolor = \"green\";\n      if ((this.data.hp / this.data.$hp) < 0.25)\n        hpcolor = \"red\";\n      else if ((this.data.hp / this.data.$hp) < 0.5)\n        hpcolor = \"yellow\";\n\n      this.hpbar.clear().rect({\n        x: 0,\n        y: 0,\n        width: Math.floor((this.data.hp / this.data.$hp) * 30),\n        height: 3,\n        fill: hpcolor,\n        \"stroke-width\": 0\n      });\n\n      this.mpbar.clear().rect({\n        x: 0,\n        y: 0,\n        width: Math.floor((this.data.sp / this.data.$sp) * 30),\n        height: 3,\n        fill: \"blue\",\n        \"stroke-width\": 0\n      });\n    }\n\n    popup (text) {\n      var dialogueText = new Sprite.Text({\n        text: text,\n        maxWidth: 200,\n      });\n      var w = dialogueText.width;\n      var h = dialogueText.height;\n      var middle = Math.round((w + 10) / 2);\n\n      var dialogueBox = new Sprite.Shape();\n      dialogueBox.rect({\n        x : 0,\n        y: 0,\n        width: w + 10,\n        height: h + 10,\n        stroke: \"black\",\n        fill: \"white\",\n      });\n\n      /*\n      dialogueBox.polygon({\n        points: [\n          middle - 5, h + 9,\n          middle + 5, h + 9,\n          middle - 5, h + 9,\n        ].join(\", \"),\n        fill: \"white\"\n      });\n      */\n\n      var dialogueContainer = new Sprite.Container();\n      dialogueContainer.appendChild(dialogueBox, dialogueText);\n      dialogueText.x = 5;\n      dialogueText.y = 5;\n      dialogueContainer.x = this.x;\n      dialogueContainer.y = this.y - this.sprite.center.y - 30;\n      dialogueContainer.center.x = middle;\n      dialogueContainer.center.y = h + 15;\n      dialogueContainer.height = h + 15;\n      dialogueContainer.width = w + 10;\n\n      if (!this.popupBox) {\n        this.popupBox = {};\n      }\n\n      if (Object.keys(this.popupBox).length > 0) {\n        for (var key in this.popupBox) {\n          this.popupBox[key].center.y += this.popupBox[key].height;\n        }\n      }\n\n      var id = Sprite.Util.id();\n\n      this.popupBox[id] = dialogueContainer;\n      Game.dialogueLayer.appendChild(this.popupBox[id]);\n\n      setTimeout(() => {\n        if (this.popupBox[id]) {\n          Game.dialogueLayer.removeChild(this.popupBox[id]);\n          delete this.popupBox[id];\n        }\n      }, 4000);\n    }\n\n    contact () {\n      if (this.data.contact) {\n        if (this.data.contact.type == \"talk\") {\n          this.popup(this.data.contact.content);\n        }\n      }\n    }\n\n    distance (x, y) {\n      var d = 0;\n      d += Math.pow(this.x - x, 2);\n      d += Math.pow(this.y - y, 2);\n      return parseInt(Math.sqrt(d));\n    }\n\n    decreaseHitpoint (power) {\n      this.data.hp -= power;\n      this.refreshBar();\n      this.dead();\n    }\n\n    decreaseManapoint (mp) {\n      this.data.sp -= mp;\n      this.refreshBar();\n    }\n\n    dead () {\n      if (this.data.hp <= 0) {\n\n        // item0001是物品掉落之后出现的小布袋\n        var dead = Game.items.bag.clone();\n        dead.x = this.x;\n        dead.y = this.y;\n        dead.draw(Game.itemLayer);\n        dead.inner = {\n          \"gold\": 1\n        };\n        Game.area.bags[Sprite.Util.id()] = dead;\n\n        Game.actorLayer.removeChild(this.infoBox);\n        Game.actorLayer.removeChild(this.sprite);\n\n        delete Game.area.actors[this.id];\n\n      }\n    }\n\n    damage (type, power) {\n\n      if (type == \"normal\") {\n        power = Math.max(0, power - this.data.def);\n      } else { // type == magic\n        power = Math.max(0, power - this.data.mdef);\n      }\n\n      var text = new Sprite.Text({\n        text: \"-\" + power,\n        color: \"white\",\n        fontSize: 16\n      });\n      text.center.x = Math.floor(text.width / 2);\n      text.center.y = Math.floor(text.height);\n      text.x = this.x;\n      text.y = this.y;\n\n      Game.actorLayer.appendChild(text);\n\n      var inter = setInterval(() => {\n        text.y -= 4;\n      }, 50);\n\n      setTimeout(() => {\n        Game.actorLayer.removeChild(text);\n        clearInterval(inter);\n      }, 2000);\n\n      this.decreaseHitpoint(power);\n    }\n\n    play (animation, priority) {\n      var direction = animation.match(/down|left|right|up/)[0];\n\n      // 新动画默认优先级为0\n      if (typeof priority == \"undefined\")\n        priority = 0;\n\n      // 无动画或者停止状态，现有优先级为-1（最低级）\n      if (typeof this.animationPriority == \"undefined\" || this.sprite.paused == true)\n        this.animationPriority = -1;\n\n      if (this.data.animations.hasOwnProperty(animation)\n      && priority >= this.animationPriority\n      && animation != this.sprite.currentAnimation) {\n        this.animationPriority = priority;\n        this.sprite.play(animation);\n      }\n    }\n\n    stop () {\n      if (!this.sprite.currentAnimation) return;\n\n      if (this.gotoListener) return;\n\n      if ((this.sprite.paused && !this.sprite.currentAnimation.match(/face/))\n        || this.sprite.currentAnimation.match(/walk|run/)) {\n        switch (this.sprite.currentAnimation.match(/up|down|left|right/)[0]) {\n          case \"up\":\n            this.sprite.play(\"faceup\");\n            break;\n          case \"down\":\n            this.sprite.play(\"facedown\");\n            break;\n          case \"left\":\n            this.sprite.play(\"faceleft\");\n            break;\n          case \"right\":\n            this.sprite.play(\"faceright\");\n            break;\n        }\n      }\n    }\n\n    fire (id, direction) {\n      // 同一时间只能施展一个skill\n      if (this.attacking)\n        return 0;\n\n      var skill = this.skills[id];\n      if (!skill)\n        return 0;\n\n      // 只有当这个skill的cooldown结\n      var now = new Date().getTime();\n      if ( typeof this.lastAttack == \"number\"\n        && typeof this.lastAttackCooldown == \"number\"\n        && (now - this.lastAttack) < this.lastAttackCooldown)\n        return 0;\n\n      if (skill.data.cost > this.data.sp) {\n        return 0;\n      }\n\n      this.lastAttack = now;\n      this.lastAttackCooldown = skill.data.cooldown;\n      this.attacking = true;\n\n      if (!direction) {\n        direction = this.sprite.currentAnimation.match(/up|left|down|right/)[0];\n      }\n\n      skill.fire(this, \"attack\" + direction, (hittedActorIds) => {\n        this.attacking = false;\n        if (hittedActorIds && hittedActorIds.length) {\n          hittedActorIds.forEach((element) => {\n            Game.area.actors[element].damage(skill.data.type, skill.data.power);\n          });\n        }\n      });\n\n      return skill.data.cooldown;\n    }\n\n    goto (x, y, speed, collisionTest, callback) {\n\n      if (this.gotoListener) {\n        Sprite.Ticker.off(\"tick\", this.gotoListener);\n        this.gotoListener = null;\n      }\n\n      x -= this.x;\n      y -= this.y;\n\n      var state = \"walk\";\n      var limit = 20;\n      var skew = speed / 1.4;\n\n      this.gotoListener = Sprite.Ticker.on(\"tick\", () => toXY());\n\n      var leftright = \"\";\n      var updown = \"\";\n      if (x > 0) {\n        leftright = \"right\";\n      } else if (x < 0) {\n        leftright = \"left\";\n      }\n      if (y > 0) {\n        updown = \"down\";\n      } else if (y < 0) {\n        updown = \"up\";\n      }\n      var X = x = Math.abs(x);\n      var Y = y = Math.abs(y);\n\n      var toXY = () => {\n        if (x <= limit && y <= limit) {\n          if (this.gotoListener) {\n            Sprite.Ticker.off(\"tick\", this.gotoListener);\n            this.gotoListener = null;\n          }\n          if (X > Y) {\n            this.face(leftright);\n          } else {\n            this.face(updown);\n          }\n          if (callback) callback();\n        } else if (x > limit && y > limit) {\n          if (X > Y) {\n            this.go(state, leftright, speed, collisionTest);\n            x -= speed;\n          } else {\n            this.go(state, updown, speed, collisionTest);\n            y -= speed;\n          }\n          if (x < 0) x = 0;\n          if (y < 0) y = 0;\n        } else if (x > limit) {\n          this.go(state, leftright, speed, collisionTest);\n          x -= speed;\n          if (x < 0) x = 0;\n        } else if (y > limit) {\n          this.go(state, updown, speed, collisionTest);\n          y -= speed;\n          if (y < 0) y = 0;\n        }\n      }\n\n    }\n\n    face (direction) {\n      var animation = \"face\" + direction;\n      if (this.animation != animation) {\n        this.sprite.play(animation);\n      }\n    }\n\n    // 这个函数是测试某个方向能否走，能移动则移动\n    // direction的值有up，down，left，right四种可能\n    // 建立这个函数是因为一次行走虽然是一次，但是也可以潮四个角方向走，实际就要执行两次CheckDirection\n    CheckDirection (direction, step, collisionTest) {\n\n      var oldX = this.x;\n      var oldY = this.y;\n\n      switch (direction) {\n        case \"up\":\n          this.y += -step;\n          break;\n        case \"down\":\n          this.y += step;\n          break;\n        case \"left\":\n          this.x += -step;\n          break;\n        case \"right\":\n          this.x += step;\n          break;\n      }\n\n      this.x = parseInt(this.x);\n      this.y = parseInt(this.y);\n\n      var t = Game.area.map.tile(this.x, this.y);\n\n      var tested = {};\n\n      // 参数t中记录了某个方格的方位xy，测试这个方格是否和玩家有冲突\n      var CheckCollision = (t) => {\n        if (t.x < 0 || t.y < 0 || t.x >= Game.area.map.data.width || t.y >= Game.area.map.data.height)\n          return true;\n\n        var i = t.x + \"-\" + t.y;\n        if (tested.hasOwnProperty(i))\n          return tested[i];\n\n        if (Game.area.map.blockedMap[t.y] && Game.area.map.blockedMap[t.y][t.x]) {\n          if (Game.actorCollision(this.sprite, Game.area.map.blockedMap[t.y][t.x])) {\n            tested[i] = true;\n            return true;\n          }\n        }\n        tested[i] = false;\n        return false;\n      };\n\n      var collision = false;\n\n      if (collisionTest) {\n        if (collision == false) collision = CheckCollision(t);\n\n        if (collision == false) collision = CheckCollision({x: t.x, y: t.y + 1});\n        if (collision == false) collision = CheckCollision({x: t.x, y: t.y - 1});\n        if (collision == false) collision = CheckCollision({x: t.x - 1, y: t.y});\n        if (collision == false) collision = CheckCollision({x: t.x + 1, y: t.y});\n\n        if (collision == false) collision = CheckCollision({x: t.x + 1, y: t.y - 1});\n        if (collision == false) collision = CheckCollision({x: t.x + 1, y: t.y + 1});\n        if (collision == false) collision = CheckCollision({x: t.x - 1, y: t.y - 1});\n        if (collision == false) collision = CheckCollision({x: t.x - 1, y: t.y + 1});\n\n        // 判断和地图上角色的碰撞\n        if (collision == false) {\n          for (var key in Game.area.actors) {\n            collision = Game.actorCollision(this.sprite, Game.area.actors[key].sprite);\n            if (collision) break;\n          }\n        }\n      }\n\n      // 碰撞了\n      if (collision) {\n        this.x = oldX;\n        this.y = oldY;\n        return false;\n      } else {\n        this.infoBox.x = this.x;\n        this.infoBox.y = this.y - this.sprite.center.y - 20;\n\n        return true;\n      }\n    }\n\n    go (state, direction, step, collisionTest) {\n      // 如果正在战斗动画，则不走\n      if (this.sprite.paused == false && this.sprite.currentAnimation.match(/skillcast|thrust|slash|shoot/)) {\n        return false;\n      }\n\n      if (this.data.weapons) {\n        if (this.bowSprite.paused == false || this.daggerSprite.paused == false || this.spearSprite.paused == false || this.woodwandSprite.paused == false)\n          return false;\n      }\n\n      if (typeof collisionTest == \"undefined\") {\n        collisionTest = true;\n      }\n\n      // 八个方向的检测\n      // 以四个角度方向为例，如果玩家希望走 右上，如果右走不了，只会会走上；上走不了，只会走右；右和上都走不了，则停止\n      // 就算走不了，也改变人物的面部朝向\n      switch (direction) {\n        case \"upleft\":\n          if (this.CheckDirection(\"up\", step, collisionTest) | this.CheckDirection(\"left\", step, collisionTest)) {\n            this.play(state + \"up\", 1);\n          } else {\n            this.play(\"faceup\", 0);\n          }\n          break;\n        case \"upright\":\n          if (this.CheckDirection(\"up\", step, collisionTest) | this.CheckDirection(\"right\", step, collisionTest)) {\n            this.play(state + \"up\", 1);\n          } else {\n            this.play(\"faceup\", 0);\n          }\n          break;\n        case \"downleft\":\n          if (this.CheckDirection(\"down\", step, collisionTest) | this.CheckDirection(\"left\", step, collisionTest)) {\n            this.play(state + \"down\", 1);\n          } else {\n            this.play(\"facedown\", 0);\n          }\n          break;\n        case \"downright\":\n          if (this.CheckDirection(\"down\", step, collisionTest) | this.CheckDirection(\"right\", step, collisionTest)) {\n            this.play(state + \"down\", 1);\n          } else {\n            this.play(\"facedown\", 0);\n          }\n          break;\n        case \"up\":\n          if (this.CheckDirection(\"up\", step, collisionTest)) {\n            this.play(state + \"up\", 1);\n          } else {\n            this.play(\"faceup\", 0);\n          }\n          break;\n        case \"down\":\n          if (this.CheckDirection(\"down\", step, collisionTest)) {\n            this.play(state + \"down\", 1);\n          } else {\n            this.play(\"facedown\", 0);\n          }\n          break;\n        case \"left\":\n          if (this.CheckDirection(\"left\", step, collisionTest)) {\n            this.play(state + \"left\", 1);\n          } else {\n            this.play(\"faceleft\", 0);\n          }\n          break;\n        case \"right\":\n          if (this.CheckDirection(\"right\", step, collisionTest)) {\n            this.play(state + \"right\", 1);\n          } else {\n            this.play(\"faceright\", 0);\n          }\n          break;\n      }\n\n      this.focus();\n      super.emit(\"move\");\n    }\n\n    remove (layer) {\n      layer.removeChild(this.sprite);\n      layer.removeChild(this.infoBox);\n    }\n\n    draw (layer) {\n      var x = this.data.x;\n      var y = this.data.y;\n\n      if (typeof x != \"number\" || typeof y != \"number\") {\n        x = Game.area.data.entry.x;\n        y = Game.area.data.entry.y;\n      }\n\n      this.infoBox.x = x;\n      this.infoBox.y = y - this.sprite.center.y - 20;\n\n      this.x = x;\n      this.y = y;\n\n      layer.appendChild(this.sprite);\n      layer.appendChild(this.infoBox);\n    }\n\n    focus () {\n      this.infoBox.x = this.x;\n      this.infoBox.y = this.y - this.sprite.center.y - 20\n\n      Game.stage.center.x = Math.round(this.x - Game.config.width / 2);\n      Game.stage.center.y = Math.round(this.y - Game.config.height / 2);\n    }\n\n  } // ActorClass\n\n})();\n"]}