{"version":3,"sources":["src/Game/Game.js"],"names":[],"mappings":"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","file":"src/Game/Game.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n    // root级别api入口\n  class GameCore {\n\n    constructor () {\n      this.items = {};\n      this.skills = {};\n      this.layers = {};\n      this.config = { // 保存所有设置（默认设置）\n        width: 800, // 渲染窗口的原始大小\n        height: 450,\n        scale: false, // 如果不拉伸，那么无论浏览器窗口多大，都是原始大小；拉伸则按比例填满窗口\n        fps: 35, // 锁定fps到指定数值，如果设置为<=0，则不限制\n      };\n      this.paused = true;\n      this.stage = null;\n    }\n\n    register (name, object) {\n      Object.defineProperty(this, name, {\n        enumerable: false,\n        configurable: false,\n        writable: false,\n        value: object\n      });\n\n      return this;\n    }\n\n    /** 设置游戏暂停标志为false，启动游戏主循环，接受输入 */\n    start () {\n      this.paused = false;\n    }\n\n    /** 暂停游戏 */\n    pause () {\n      this.paused = true;\n    }\n\n    /** 清理舞台，即删除舞台上所有元素 */\n    clearStage () {\n      for (let i = 0; i < Game.stage.children.length; i++) {\n        this.stage.children[i].clear();\n      }\n    }\n\n    /** 游戏初始化 */\n    init () {\n\n      // 舞台\n      this.stage = new Sprite.Stage(this.config.width, this.config.height);\n      // 建立一个可以自动伸缩的窗口，并将舞台加入其中\n      Game.Window.create(\"stage\").appendChild(this.stage.canvas).show();\n\n      // 地图层\n      this.layers.mapLayer = new Sprite.Container();\n      this.layers.mapLayer.name = \"mapLayer\";\n      // 物品层\n      this.layers.itemLayer = new Sprite.Container();\n      this.layers.itemLayer.name = \"itemLayer\";\n      // 人物层，包括玩家\n      this.layers.actorLayer = new Sprite.Container();\n      this.layers.actorLayer.name = \"actorLayer\";\n      // 信息层\n      this.layers.infoLayer = new Sprite.Container();\n      this.layers.infoLayer.name = \"inforLayer\";\n      // 技能效果层\n      this.layers.skillLayer = new Sprite.Container();\n      this.layers.skillLayer.name = \"skillLayer\";\n      // 对话层\n      this.layers.dialogueLayer = new Sprite.Container();\n      this.layers.dialogueLayer.name = \"dialogueLayer\";\n\n      this.stage.appendChild(\n        Game.layers.mapLayer,\n        Game.layers.itemLayer,\n        Game.layers.actorLayer,\n        Game.layers.infoLayer,\n        Game.layers.skillLayer,\n        Game.layers.dialogueLayer\n      );\n\n      // 调整人物层顺序，也就是上方的人物会被下方的人物遮盖，例如\n      /**\n       * AA BB\n       * AA BB\n       * 这样人物A和B都不干涉，但是A的位置如果在B的上面，并且紧挨着就变成了\n       * AA\n       * BB\n       * BB\n       * 这样人物A的下半身就被人物B遮盖，这就是进行排序，否则如果变成\n       * AA\n       * AA\n       * BB\n       * 这样就是B的上半身被人物A遮盖，这就很奇怪\n       */\n      this.stage.on(\"beforeDraw\", function () {\n        if (Game.hero) {\n          Game.layers.actorLayer.children.sort(function (a, b) {\n            if (a.y < b.y) return -1;\n            if (a.y > b.y) return 1;\n            return 0;\n          });\n        }\n      });\n\n      /*\n      setInterval(() => {\n        Game.stage.update();\n      }, 0);\n       */\n      Sprite.Ticker.on(\"tick\", function () {\n        if (Game.paused == false) {\n          Game.stage.update();\n        }\n      });\n\n      let fpsElement = document.createElement(\"div\");\n      fpsElement.style.position = \"absolute\";\n      fpsElement.style.left = \"0\";\n      fpsElement.style.top = \"0\";\n      fpsElement.style.color = \"white\";\n      fpsElement.style.zIndex = 999999;\n      document.body.appendChild(fpsElement);\n\n      let fps = 0;\n      let start = new Date().getTime();\n      this.stage.on(\"afterDraw\", function () {\n        fps++;\n      });\n      setInterval(function () {\n        let now = new Date().getTime();\n        let f = fps / ((now - start)/1000);\n        fps = 0;\n        start = now;\n        fpsElement.textContent = f.toFixed(1);\n      }, 1000);\n\n\n      Game.Window.resize();\n\n      console.log(\"RPG Game Flying!\");\n    }\n  };\n\n  let Game = window.Game = new GameCore();\n\n  document.body.onload = function () {\n    Game.init();\n    Game.initInput();\n    Game.AI.start();\n    Game.windows.main.show();\n  };\n\n})();\n"]}