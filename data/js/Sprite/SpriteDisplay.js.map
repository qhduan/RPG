{"version":3,"sources":["src/Sprite/SpriteDisplay.js"],"names":[],"mappings":"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","file":"src/Sprite/SpriteDisplay.js","sourcesContent":["/*\n2D Game Sprite Library, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n/// @file SpriteDisplay.js\n/// @namespace Sprite\n/// class Sprite.Display\n\n(function (Sprite) {\n  \"use strict\";\n\n  var hitCanvas = document.createElement(\"canvas\");\n  hitCanvas.width = 1;\n  hitCanvas.height = 1;\n  var hitContext = hitCanvas.getContext(\"2d\");\n  hitContext.clearRect(0, 0, 1, 1);\n  var hitData = hitContext.getImageData(0, 0, 1, 1).data;\n\n  /// @class Sprite.Display\n  /// inherit the Sprite.Event, a basic class\n  Sprite.Display = class Display extends Sprite.Event {\n\n    /// @function Sprite.Display.constructor\n    /// construct a Sprite.Display\n    constructor () {\n      super();\n\n      this._x = 0;\n      this._y = 0;\n      this._centerX = 0;\n      this._centerY = 0;\n      this._alpha = 1;\n      this._visible = true;\n      this._parent = null;\n    }\n\n    get parent () {\n      return this._parent;\n    }\n\n    set parent (value) {\n      this._parent = value;\n    }\n\n    get x () {\n      return this._x;\n    }\n\n    set x (value) {\n      if (value != this._x) {\n        this._x = value;\n        this.emit(\"change\");\n      }\n    }\n\n    get y () {\n      return this._y;\n    }\n\n    set y (value) {\n      if (value != this._y) {\n        this._y = value;\n        this.emit(\"change\");\n      }\n    }\n\n    get centerX () {\n      return this._centerX;\n    }\n\n    set centerX (value) {\n      if (value != this._centerX) {\n        this._centerX = value;\n        this.emit(\"change\");\n      }\n    }\n\n    get centerY () {\n      return this._centerY;\n    }\n\n    set centerY (value) {\n      if (value != this._centerY) {\n        this._centerY = value;\n        this.emit(\"change\");\n      }\n    }\n\n\n\n    get alpha () {\n      return this._alpha;\n    }\n\n    set alpha (value) {\n      if (value != this._alpha) {\n        this._alpha = value;\n        this.emit(\"change\");\n      }\n    }\n\n    get visible () {\n      return this._visible;\n    }\n\n    set visible (value) {\n      if (value != this._visible) {\n        this._visible = value;\n        this.emit(\"change\");\n      }\n    }\n\n    realPosition () {\n      var scale = {\n        x: this.scaleX,\n        y: this.scaleY\n      };\n      var center = {\n        x: this.centerX,\n        y: this.centerY\n      };\n      var position = {\n        x: this.x,\n        y: this.y\n      };\n\n      var obj = this.parent;\n      while (obj) {\n        scale.x *= obj.scaleX;\n        scale.y *= obj.scaleY;\n        center.x += obj.centerX;\n        center.y += obj.centerY;\n        position.x += obj.x;\n        position.y += obj.y;\n        obj = obj.parent;\n      }\n\n      position.x = (position.x - center.x) * scale.x;\n      position.y = (position.y - center.y) * scale.y;\n      position.x = Math.floor(position.x);\n      position.y = Math.floor(position.y);\n\n      return {\n        position,\n        center,\n        scale,\n      };\n    }\n\n    /// @function Sprite.Display.draw\n    draw (context) {\n      throw new Error(\"Invalid call Sprite.Display.draw\");\n    }\n\n    /// @function Sprite.Display.hitTest\n    hitTest (x, y) {\n\n      /*\n      var data = this.realPosition();\n      var dx = Math.floor(data.position.x);\n      var dy = Math.floor(data.position.y);\n      var dwidth = Math.floor(100 * data.scaleX);\n      var dheight = Math.floor(100 * data.scaleY);\n      if (dx > x && dy > y)\n        return false;\n      if ((dx + dwidth) < x && (dy + dheight) < y)\n        return false;\n        */\n\n      hitContext.clearRect(0, 0, 1, 1);\n      hitContext.save();\n      hitContext.translate(-x, -y);\n      this.draw(hitContext);\n      hitContext.restore();\n      var newData = hitContext.getImageData(0, 0, 1, 1).data;\n\n      if (hitData[0] != newData[0] || hitData[1] != newData[1] || hitData[2] != newData[2]) {\n        return true;\n      }\n      /*\n      context.clearRect(x, y, 1, 1);\n      var oldData = context.getImageData(x, y, 1, 1).data;\n      this.draw(context);\n      var newData = context.getImageData(x, y, 1, 1).data;\n      if (oldData[0] != newData[0] || oldData[1] != newData[1] || oldData[2] != newData[2]) {\n        return true;\n      }\n      */\n\n      return false;\n    }\n\n    /// @function Sprite.Display.drawImage\n    /// image, draw a 'box' from.scaleX.scaleY to swidth,sheight on context\n    /// x=0,y=0--------------------------------------\n    /// -                                           -\n    /// -    sx.sy------------                      -\n    /// -    -               -                      -\n    /// -    ---swidth,sheight                      -\n    /// -                                           -\n    /// ---------------------image.width,image.height\n    /// draw an image on context\n    /// @param context a 2d context from canvas\n    /// @param image, the image we wang to draw\n    /// @param.scaleX the x position of image\n    /// @param.scaleY the y position of image\n    /// @param swidth the width of image we want to draw\n    /// @param sheight the height of image we want to draw\n    drawImage (renderer, image, sx, sy, swidth, sheight) {\n      if (this.visible == true && this.alpha > 0) {\n        var center = {\n          x: this.centerX,\n          y: this.centerY\n        };\n        var position = {\n          x: this.x,\n          y: this.y\n        };\n\n        var obj = this.parent;\n        while (obj) {\n          center.x += obj.centerX;\n          center.y += obj.centerY;\n          position.x += obj.x;\n          position.y += obj.y;\n          obj = obj.parent;\n        }\n\n        var dx = position.x - center.x;\n        var dy = position.y - center.y;\n\n        renderer.alpha = this.alpha;\n        renderer.drawImage(\n          image, sx, sy, swidth, sheight,\n          dx, dy, swidth, sheight\n        );\n      }\n    }\n  };\n\n})(Sprite);\n"]}