{"version":3,"sources":["src/Sprite/SpriteText.js"],"names":[],"mappings":"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","file":"src/Sprite/SpriteText.js","sourcesContent":["/*\n\n2D Game Sprite Library, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n/**\n * @fileoverview Define the Sprite.Text to show text in game\n * @author mail@qhduan.com (QH Duan)\n */\n\n (function () {\n   \"use strict\";\n\n  let internal = Sprite.Namespace();\n\n  let textCanvas = document.createElement(\"canvas\");\n  textCanvas.width = 1;\n  textCanvas.height = 1;\n  let textContext = textCanvas.getContext(\"2d\");\n\n  /**\n   * Class Sprite.Text, contain text\n   * @class\n   * @extends Sprite.Display\n   */\n  Sprite.assign(\"Text\", class SpriteText extends Sprite.Display {\n    /**\n     * construct Sprite.Text\n     * @constructor\n     */\n    constructor (config) {\n      super();\n      let privates = internal(this);\n      privates.text = config.text || \"Invalid Text\";\n      privates.maxWidth = config.maxWidth || 1000;\n      privates.color = config.color || \"black\";\n      privates.fontSize = config.fontSize || 14;\n      privates.fontFamily = config.fontFamily || \"Ariel\";\n      privates.image = null;\n      this.generate();\n    }\n\n    clone () {\n      let privates = internal(this);\n      let text = new Text({\n        text: privates.text,\n        maxWidth: privates.maxWidth,\n        color: privates.color,\n        fontSize: privates.fontSize,\n        fontFamily: privates.fontFamily\n      });\n      text.x = this.x;\n      text.y = this.y;\n      text.centerX = this.centerX;\n      text.centerY = this.centerY;\n      text.alpha = this.alpha;\n      text.visible = this.visible;\n      return text;\n    }\n\n    get text () {\n      let privates = internal(this);\n      return privates.text;\n    }\n\n    set text (value) {\n      let privates = internal(this);\n      if (value != this.text) {\n        privates.text = value;\n        this.generate();\n      }\n    }\n\n    get width () {\n      let privates = internal(this);\n      return privates.width;\n    }\n\n    set width (value) {\n      let privates = internal(this);\n      if (value != this.width) {\n        privates.width = value;\n        this.generate();\n      }\n    }\n\n    get height () {\n      let privates = internal(this);\n      return privates.height;\n    }\n\n    set height (value) {\n      let privates = internal(this);\n      if (value != this.height) {\n        privates.height = value;\n        this.generate();\n      }\n    }\n\n    get color () {\n      let privates = internal(this);\n      return privates.color;\n    }\n\n    set color (value) {\n      let privates = internal(this);\n      if (value != this.color) {\n        privates.color = value;\n        this.generate();\n      }\n    }\n\n    get fontSize () {\n      let privates = internal(this);\n      return privates.fontSize;\n    }\n\n    set fontSize (value) {\n      let privates = internal(this);\n      if (value != this.fontSize) {\n        privates.fontSize = value;\n        this.generate();\n      }\n    }\n\n    get fontFamily () {\n      return internal(this).fontFamily;\n    }\n\n    set fontFamily (value) {\n      let privates = internal(this);\n      if (value != privates.fontFamily) {\n        privates.fontFamily = value;\n        this.generate();\n      }\n    }\n\n    generate () {\n      let privates = internal(this);\n      textContext.font = this.fontSize + \"px \" + privates.fontFamily;\n      // \"龍\" is the max-width & max-height Chinese word I think\n      let lineHeight = Math.ceil(textContext.measureText(\"龍\").width * 1.2);\n      privates.width = 0;\n\n      // find the real-maximum-width of multiline text, base user's maxWidth\n      let lines = [];\n      let lineText = \"\";\n      for (let i = 0, len = this.text.length; i < len; i++) {\n        if (textContext.measureText(lineText + this.text[i]).width > this.maxWidth) {\n          lines.push(lineText);\n          lineText = this.text[i];\n        } else {\n          lineText += this.text[i];\n        }\n        if (textContext.measureText(lineText).width > this.width)\n          privates.width = Math.ceil(textContext.measureText(lineText).width);\n      }\n\n      if (lineText.length) {\n        lines.push(lineText);\n      }\n\n      this.height = lines.length * lineHeight;\n\n      let canvas = document.createElement(\"canvas\");\n      canvas.width = this.width;\n      canvas.height = this.height;\n      let context = canvas.getContext(\"2d\");\n      context.font = this.fontSize + \"px \" + this.fontFamily;\n      context.fillStyle = this.color;\n      context.textAlign = \"center\";\n      context.textBaseline = \"top\";\n      // draw each line\n      lines.forEach((element, index) => {\n        context.fillText(element, canvas.width/2, index*lineHeight)\n      });\n\n      privates.image = null;\n      privates.image = canvas;\n    }\n\n    draw (context) {\n      let privates = internal(this);\n      let image = privates.image;\n      if ( image && image.width > 0 && image.height > 0) {\n        this.drawImage(\n          context,\n          image,\n          0,\n          0,\n          image.width,\n          image.height\n        );\n      }\n    }\n  });\n\n\n})();\n"]}