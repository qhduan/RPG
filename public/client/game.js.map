{"version":3,"sources":["public/src/game.js"],"names":[],"mappings":"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","file":"public/src/game.js","sourcesContent":["/*\n\nOnline A-RPG Game, Built using Node.js + createjs\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n(function () {\n  \"use strict\";\n\n  (function( win ){\n\tvar doc = win.document;\n\n\t// If there's a hash, or addEventListener is undefined, stop here\n\tif(!win.navigator.standalone && !location.hash && win.addEventListener ){\n\n\t\t//scroll to 1\n\t\twin.scrollTo( 0, 1 );\n\t\tvar scrollTop = 1,\n\t\t\tgetScrollTop = function(){\n\t\t\t\treturn win.pageYOffset || doc.compatMode === \"CSS1Compat\" && doc.documentElement.scrollTop || doc.body.scrollTop || 0;\n\t\t\t},\n\n\t\t\t//reset to 0 on bodyready, if needed\n\t\t\tbodycheck = setInterval(function(){\n\t\t\t\tif( doc.body ){\n\t\t\t\t\tclearInterval( bodycheck );\n\t\t\t\t\tscrollTop = getScrollTop();\n\t\t\t\t\twin.scrollTo( 0, scrollTop === 1 ? 0 : 1 );\n\t\t\t\t}\n\t\t\t}, 15 );\n\n\t\twin.addEventListener( \"load\", function(){\n\t\t\tsetTimeout(function(){\n\t\t\t\t//at load, if user hasn't scrolled more than 20 or so...\n\t\t\t\tif( getScrollTop() < 20 ){\n\t\t\t\t\t//reset to hide addr bar at onload\n\t\t\t\t\twin.scrollTo( 0, scrollTop === 1 ? 0 : 1 );\n\t\t\t\t}\n\t\t\t}, 0);\n\t\t}, false );\n\t}\n})( window );\n\n  // root级别api入口\n  var Game = window.Game = {\n    items: {}, // 物品的缓冲\n    resources: {}, // 保存所有音频，图像等，结构为 { src: object }\n    config: { // 保存所有设置（默认设置）\n      walk: 4, // 角色行走速度\n      run: 8, // 角色跑动速度\n      width: 960, // 渲染窗口的大小，更大的大小是经过收缩的\n      height: 540\n    }\n  };\n\n  Game.EventClass = class EventClass {\n    constructor () {\n      this.listeners = {};\n      this.once = {};\n    }\n\n    on (event, callback) {\n      if (this.once[event])\n        return callback(this);\n\n      if (!this.listeners[event])\n        this.listeners[event] = {};\n\n      var id = uuid.v4();\n      this.listeners[event][id] = callback;\n    }\n\n    off (event, id) {\n      if (this.listeners[event] && this.listeners[event][id]) {\n        delete this.listeners[event][id];\n        return true;\n      }\n      return false;\n    }\n\n    emit (event, once) {\n      if (this.listeners[event]) {\n        for (let key in this.listeners[event]) {\n          this.listeners[event][key](this);\n        }\n      }\n      if (once) {\n        this.once[event] = true;\n      }\n    }\n  };\n\n  // 如果为true，则在下一次tick事件后会调用stage.update，然后再自动置为false\n  var updateStageNextTick = false;\n\n  Game.update = function () {\n    updateStageNextTick = true;\n  };\n\n  var oninitCallbackList = [];\n  var inited = false;\n\n  Game.oninit = function (callback) {\n    if (inited) callback();\n    else oninitCallbackList.push(callback);\n  };\n\n  Game.preload = function (resources, callback) {\n\n    // image.json中包含一些游戏无论如何都需要的图片，所以必须加载\n    resources = [\"/image.json\"].concat(Object.keys(resources));\n\n    // 排除已经有了的图片\n    resources = resources.filter(function (element) {\n      if (Game.resources.hasOwnProperty(element))\n        return false;\n      return true;\n    });\n\n    // 如果所有图片都有了，就立刻回调\n    if (resources.length <= 0) {\n      return callback();\n    }\n\n    // 进度条\n    var con = document.getElementById(\"ProgressBar\");\n    var bar = document.getElementById(\"ProgressBarInner\");\n    var second = 0;\n    var opacity = 100;\n    var start = new Date().getTime();\n    con.style.zIndex = 999;\n    con.style.opacity = 1;\n    bar.style.width = \"20%\";\n    bar.innerHTML = \"\";\n\n    // 新建队列，加载sound插件\n    var queue = new createjs.LoadQueue(true);\n    queue.installPlugin(createjs.Sound);\n\n    // 向进度条反馈进度\n    queue.on(\"progress\", function (event) {\n      var progress = queue.progress;\n      var now = new Date().getTime();\n\n      var second = (now - start) / 1000;\n\n      progress *= 80;\n      progress += 20;\n      progress = progress.toFixed(0) + \"%\";\n\n      // 更新进度条\n      bar.style.width = progress;\n      bar.innerHTML = second.toFixed(2) + \"s \" + progress;\n    });\n\n    queue.on(\"complete\", function() {\n\n      (function HideLoadingBar() {\n        opacity -= 10;\n        con.style.opacity = opacity / 100;\n        if (opacity <= 0) {\n          con.style.zIndex = -999;\n        } else {\n          setTimeout(HideLoadingBar, 25);\n        }\n      })();\n\n      resources.forEach(function (element) {\n        var obj = queue.getResult(element);\n        Game.resources[element] = obj;\n\n        // 把image.json中的base64 data uri的图片转换为DOM element\n        if (element == \"/image.json\") {\n          for (var key in obj) {\n            var image = new Image();\n            image.src = obj[key];\n            Game.resources[key] = image;\n          }\n        }\n\n      });\n      callback();\n    }, this);\n\n    resources.forEach(function (element) {\n\n      if (element.indexOf(\".ogg\") != -1) {\n        var a = new Audio();\n        if (a.canPlayType(\"audio/ogg\").length) {\n          queue.loadFile({\n            src: element\n          });\n        } else if (a.canPlayType(\"audio/mpeg\").length) {\n          queue.loadFile({\n            src: element.replace(\".ogg\", \".mp3\")\n          });\n        }\n      } else {\n        queue.loadFile({\n          src: element\n        });\n      }\n\n    });\n  };\n\n  Game.init = function () {\n\n    createjs.Ticker.framerate = 60;\n    createjs.Ticker.timingMode = createjs.Ticker.RAF_SYNCHED;\n\n    var canvasObj = document.getElementById(\"game\");\n    canvasObj.width = Game.config.width;\n    canvasObj.height = Game.config.height;\n    Game.stage = new createjs.Stage(canvasObj);\n    Game.stage.enableMouseOver(10);\n    createjs.Touch.enable(Game.stage);\n\n    Game.mapLayer = new createjs.Container();\n    Game.mapLayer.name = \"mapLayer\";\n\n    Game.actorLayer = new createjs.Container();\n    Game.actorLayer.name = \"actorLayer\";\n\n    Game.itemLayer = new createjs.Container();\n    Game.itemLayer.name = \"itemLayer\";\n\n    Game.heroLayer = new createjs.Container();\n    Game.heroLayer.name = \"heroLayer\";\n\n    Game.playerLayer = new createjs.Container();\n    Game.playerLayer.name = \"playerLayer\";\n\n    Game.spellLayer = new createjs.Container();\n    Game.spellLayer.name = \"spellLayer\";\n\n    Game.dialogueLayer = new createjs.Container();\n    Game.dialogueLayer.name = \"dialogueLayer\";\n\n    Game.uiLayer = new createjs.Container();\n    Game.uiLayer.name = \"uiLayer\";\n\n    Game.stage.addChild(\n      Game.mapLayer,\n      Game.actorLayer,\n      Game.itemLayer,\n      Game.heroLayer,\n      Game.playerLayer,\n      Game.spellLayer,\n      Game.dialogueLayer,\n      Game.uiLayer\n    );\n\n    createjs.Ticker.on(\"tick\", function () {\n      if (updateStageNextTick) {\n        Game.stage.update();\n        updateStageNextTick = false;\n      }\n    });\n\n    CalculateWindowSize();\n    window.addEventListener(\"resize\", function () {\n      CalculateWindowSize();\n    });\n\n    inited = true;\n    oninitCallbackList.forEach(function (element) {\n      element();\n    });\n\n    console.log(\"RPG Game Flying!\");\n  };\n\n  // 当窗口大小改变时改变游戏窗口大小\n  function CalculateWindowSize () {\n    var width = window.innerWidth;\n    var height = window.innerHeight;\n\n    var ratio = Game.config.width / Game.config.height;\n\n    // width first\n    var w = width;\n    var h = w / ratio;\n\n    // then height\n    if (h > height) {\n      h = height;\n      w = h * ratio;\n    }\n\n    w = parseInt(w);\n    h = parseInt(h);\n    var left = (width - w) / 2;\n\n    Game.stage.canvas.style.left = left.toFixed(0) + \"px\";\n\n    var scale = Math.min(\n      w / Game.config.width,\n      h / Game.config.height\n    );\n\n    //if (w < Game.config.width || h < Game.config.height) {\n    //  w = Game.config.width;\n    //  h = Game.config.height;\n    //  scale = 1;\n    //}\n\n\n    //Game.stage.setTransform(0, 0, scale, scale);\n    Game.stage.scaleX = scale;\n    Game.stage.scaleY = scale;\n    Game.stage.canvas.width = w;\n    Game.stage.canvas.height = h;\n\n    if (Game.hero) Game.hero.focus();\n\n    Game.stage.update();\n\n  };\n\n\n})();\n"]}