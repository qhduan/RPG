{"version":3,"sources":["src/Game/GameWindowArchive.js"],"names":[],"mappings":"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","file":"src/Game/GameWindowArchive.js","sourcesContent":["/*\n\nA-RPG Game, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n(function () {\n  \"use strict\";\n\n\n  let win = Game.Window.create(\"archive\");\n\n  win.html = `\n    <div class=\"window-box\">\n      <div id=\"archiveWindowItemBar\">\n        <button id=\"archiveWindowClose\" class=\"brownButton\">关闭</button>\n        <button id=\"archiveWindowSave\" class=\"brownButton\">保存</button>\n      </div>\n      <div id=\"archiveWindowTable\"></div>\n    </div>\n  `;\n\n  win.css = `\n    #archiveWindowTable {\n      width: 100%;\n      overflow-y: auto;\n      height: 320px;\n    }\n\n    .archiveItem {\n      border: 1px solid gray;\n      border-radius: 10px;\n      margin: 10px 10px;\n    }\n\n    .archiveItem > button {\n      width: 100px;\n      height: 40px;\n      border-radius: 5px;\n    }\n\n    #archiveWindowItemBar button {\n      width: 100px;\n      height: 30px;\n      font-size: 16px;\n      display: block;\n      margin-bottom: 5px;\n    }\n\n    #archiveWindowClose {\n      float: right;\n    }\n  `;\n\n  let archiveWindowSave = document.querySelector(\"button#archiveWindowSave\");\n  let archiveWindowClose = document.querySelector(\"button#archiveWindowClose\");\n  let archiveWindowTable = document.querySelector(\"#archiveWindowTable\");\n\n  archiveWindowSave.addEventListener(\"click\", function () {\n    let canvas = document.createElement(\"canvas\");\n    canvas.width = 80;\n    canvas.height = 45;\n    let context = canvas.getContext(\"2d\");\n    context.drawImage(Game.stage.canvas, 0, 0, Game.stage.canvas.width, Game.stage.canvas.height, 0, 0, 80, 45);\n\n    Game.Archive.save({\n      hero: Game.hero.data,\n      screenshot: canvas.toDataURL(\"image/jpeg\")\n    });\n\n    win.open();\n  });\n\n  archiveWindowClose.addEventListener(\"click\", function () {\n    win.hide();\n  });\n\n  win.whenUp([\"esc\"], function (key) {\n    setTimeout(function () {\n      win.hide();\n    }, 20);\n  });\n\n  win.register(\"open\", function () {\n\n    if (Game.hero && Game.windows.main.atop == false) {\n      archiveWindowSave.style.visibility = \"visible\";\n    } else {\n      archiveWindowSave.style.visibility = \"hidden\";\n    }\n\n    let table = \"\";\n    let list = Game.Archive.list();\n    list.forEach(function (element) {\n      let line = `<div class=\"archiveItem\">\\n`;\n      let archive = Game.Archive.get(`SAVE_${element}`);\n      line += `  <button data-type=\"remove\" data-id=\"SAVE_${element}\" class=\"brownButton\" style=\"float: right;\">删除</button>\\n`;\n      line += `  <button data-type=\"load\" data-id=\"SAVE_${element}\" class=\"brownButton\" style=\"float: right;\">读取</button>\\n`;\n      line += `  <img alt=\"\" src=\"${archive.screenshot || \"\"}\" width=\"80\" height=\"45\" style=\"display: inline-block; margin: 5px;\">\\n`;\n      line += `  <label style=\"font-size: 20px; margin: 10px;\">${archive.name}</label>\\n`;\n      line += `  <label style=\"margin: 10px;\">${archive.date}</label>\\n`;\n      line += \"</div>\\n\"\n      table += line;\n    });\n\n    archiveWindowTable.innerHTML = table;\n    Game.windows.archive.show();\n  });\n\n  archiveWindowTable.addEventListener(\"click\", function (event) {\n    let type = event.target.getAttribute(\"data-type\");\n    let id = event.target.getAttribute(\"data-id\");\n    if (type && id) {\n      if (type == \"remove\") {\n        Game.Archive.remove(id);\n        win.open();\n      } else if (type == \"load\") {\n        Game.Archive.load(id);\n        win.hide();\n      }\n    }\n  });\n\n\n})();\n"]}