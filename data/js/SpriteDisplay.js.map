{"version":3,"sources":["src/SpriteDisplay.js"],"names":[],"mappings":"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","file":"src/SpriteDisplay.js","sourcesContent":["/*\n\n2D Game Sprite Library, Built using JavaScript ES6\nCopyright (C) 2015 qhduan(http://qhduan.com)\n\nThis program is free software: you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License\nalong with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n*/\n\n/// @file SpriteDisplay.js\n/// @namespace Sprite\n/// class Sprite.Display\n\n(function () {\n  \"use strict\";\n\n  var hitCanvas = document.createElement(\"canvas\");\n  hitCanvas.width = 1;\n  hitCanvas.height = 1;\n  var hitContext = hitCanvas.getContext(\"2d\");\n  hitContext.clearRect(0, 0, 1, 1);\n  var hitData = hitContext.getImageData(0, 0, 1, 1).data;\n\n  /// @class Sprite.Display\n  /// inherit the Sprite.Event, a basic class\n  Sprite.Display = class Display extends Sprite.Event {\n\n    /// @function Sprite.Display.constructor\n    /// construct a Sprite.Display\n    constructor () {\n      super();\n\n      this._x = 0;\n      this._y = 0;\n      this._scale = {\n        x: 1,\n        y: 1,\n      };\n      this._center = {\n        x: 1,\n        y: 1,\n      };\n      this._alpha = 1;\n      this._visible = true;\n      this._parent = null;\n    }\n\n    get parent () {\n      return this._parent;\n    }\n\n    set parent (value) {\n      this._parent = value;\n    }\n\n    get x () {\n      return this._x;\n    }\n\n    set x (value) {\n      if (value != this._x) {\n        this._x = value;\n        this.emit(\"change\");\n      }\n    }\n\n    get y () {\n      return this._y;\n    }\n\n    set y (value) {\n      if (value != this._y) {\n        this._y = value;\n        this.emit(\"change\");\n      }\n    }\n\n    get scale () {\n      return this._scale;\n    }\n\n    set scale (value) {\n      if (value != this._scale) {\n        this._scale = value;\n        this.emit(\"change\");\n      }\n    }\n\n    get center () {\n      return this._center;\n    }\n\n    set center (value) {\n      if (value != this._center) {\n        this._center = value;\n        this.emit(\"change\");\n      }\n    }\n\n    get alpha () {\n      return this._alpha;\n    }\n\n    set alpha (value) {\n      if (value != this._alpha) {\n        this._alpha = value;\n        this.emit(\"change\");\n      }\n    }\n\n    get visible () {\n      return this._visible;\n    }\n\n    set visible (value) {\n      if (value != this._visible) {\n        this._visible = value;\n        this.emit(\"change\");\n      }\n    }\n\n    realPosition () {\n      var scale = {\n        x: this.scale.x,\n        y: this.scale.y,\n      };\n      var center = {\n        x: this.center.x,\n        y: this.center.y,\n      };\n      var position = {\n        x: this.x,\n        y: this.y,\n      };\n\n      var obj = this.parent;\n      while (obj) {\n        scale.x *= obj.scale.x;\n        scale.y *= obj.scale.y;\n        center.x += obj.center.x;\n        center.y += obj.center.y;\n        position.x += obj.x;\n        position.y += obj.y;\n        obj = obj.parent;\n      }\n\n      position.x = (position.x - center.x) * scale.x;\n      position.y = (position.y - center.y) * scale.y;\n      position.x = Math.floor(position.x);\n      position.y = Math.floor(position.y);\n\n      return {\n        position,\n        center,\n        scale,\n      };\n    }\n\n    /// @function Sprite.Display.draw\n    draw (context) {\n      throw new Error(\"Invalid call Sprite.Display.draw\");\n    }\n\n    /// @function Sprite.Display.hitTest\n    hitTest (x, y) {\n\n      /*\n      var data = this.realPosition();\n\n      var dx = Math.floor(data.position.x);\n      var dy = Math.floor(data.position.y);\n      var dwidth = Math.floor(100 * data.scale.x);\n      var dheight = Math.floor(100 * data.scale.y);\n\n\n      if (dx > x && dy > y)\n        return false;\n      if ((dx + dwidth) < x && (dy + dheight) < y)\n        return false;\n        */\n\n      hitContext.clearRect(0, 0, 1, 1);\n      hitContext.save();\n      hitContext.translate(-x, -y);\n      this.draw(hitContext);\n      hitContext.restore();\n      var newData = hitContext.getImageData(0, 0, 1, 1).data;\n\n      if (hitData[0] != newData[0] || hitData[1] != newData[1] || hitData[2] != newData[2]) {\n        return true;\n      }\n      /*\n      context.clearRect(x, y, 1, 1);\n      var oldData = context.getImageData(x, y, 1, 1).data;\n      this.draw(context);\n      var newData = context.getImageData(x, y, 1, 1).data;\n\n      if (oldData[0] != newData[0] || oldData[1] != newData[1] || oldData[2] != newData[2]) {\n        return true;\n      }\n      */\n\n      return false;\n    }\n\n    /// @function Sprite.Display.drawImage\n    /// image, draw a 'box' from.scale.x.scale.y to swidth,sheight on context\n    /// x=0,y=0--------------------------------------\n    /// -                                           -\n    /// -    sx.sy------------                      -\n    /// -    -               -                      -\n    /// -    ---swidth,sheight                      -\n    /// -                                           -\n    /// ---------------------image.width,image.height\n    /// draw an image on context\n    /// @param context a 2d context from canvas\n    /// @param image, the image we wang to draw\n    /// @param.scale.x the x position of image\n    /// @param.scale.y the y position of image\n    /// @param swidth the width of image we want to draw\n    /// @param sheight the height of image we want to draw\n    drawImage (context, image, sx, sy, swidth, sheight) {\n      if (this.visible != true)\n        return;\n\n      var data = this.realPosition();\n\n      if (this.debug) {\n        console.log(\"debug\",\n          sx, sy, swidth, sheight,\n          data.position.x,\n          data.position.y,\n          Math.floor(swidth * data.scale.x),\n          Math.floor(sheight * data.scale.y)\n        );\n      }\n\n      sx = Math.floor(sx);\n      sy = Math.floor(sy);\n      swidth = Math.floor(swidth);\n      swidth = Math.floor(swidth);\n\n      var dx = Math.floor(data.position.x);\n      var dy = Math.floor(data.position.y);\n      var dwidth = Math.floor(swidth * data.scale.x);\n      var dheight = Math.floor(sheight * data.scale.y);\n\n      context.globalAlpha = this.alpha;\n      context.drawImage(\n        image, sx, sy, swidth, sheight,\n        dx, dy, dwidth, dheight\n      );\n    }\n  };\n\n})();\n"]}